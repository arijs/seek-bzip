#!/usr/bin/env node

var program = require('commander');
var Bunzip = require('../');
var fs = require('fs');

program
    .version(Bunzip.version)
    .usage('[infile]')
    .option('-m, --multistream',
	    'Read a multistream bzip2 file');
program.on('--help', function() {
    console.log('  If <infile> is omitted, reads from stdin.');
});
program.parse(process.argv);

var in_fd = 0, close_in = function(){};
if (program.args.length > 0) {
    in_fd = fs.openSync(program.args.shift(), 'r');
    close_in = function() { fs.closeSync(in_fd); };
}

var inStream = Bunzip.fdReadStream(in_fd);

var report = function(bytes, bits, blocksize) {
  console.log(bytes+'\t'+bits+'\t'+blocksize);
};

Bunzip.table(inStream, report, program.multistream);
close_in();
return 0;
